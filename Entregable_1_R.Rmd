---
title: "Entregable 1"
output: html_notebook
---

<br/>

###### **ADVANCED PROGRAMMING FOR DATA ANALYSIS**

###### Eugenio Lancha G√≥mez

<br/>

# MACROECONOMIA E.E.U.U & M2 LIQUIDITY

###### 

<br/>

### **Introducci√≥n**

<br/>

Este estudio se centra en el an√°lisis exhaustivo de la econom√≠a estadounidense a trav√©s de dos conjuntos de datos fundamentales que abarcan diferentes per√≠odos hist√≥ricos. La combinaci√≥n de estos datasets nos permitir√° obtener una visi√≥n hol√≠stica de la evoluci√≥n econ√≥mica de Estados Unidos, con especial √©nfasis en la relaci√≥n entre los indicadores macroecon√≥micos tradicionales y la pol√≠tica monetaria.

El an√°lisis se sustenta en la premisa de que la comprensi√≥n profunda de las interrelaciones entre variables macroecon√≥micas y monetarias es fundamental para entender los ciclos econ√≥micos, la efectividad de las pol√≠ticas monetarias, y su impacto en el bienestar econ√≥mico de la poblaci√≥n. Este estudio cobra especial relevancia en el contexto actual, donde la pol√≠tica monetaria ha jugado un papel crucial en la estabilidad econ√≥mica global.

<br/>

### **Descripci√≥n y An√°lisis de los Datasets**

<br/>

#### **1. Macroeconom√≠a EEUU (USmacro_data)**

<br/>

Este conjunto de datos, obtenido a trav√©s de Kaggle (kaggle.com), proporciona una visi√≥n mensual detallada de la econom√≠a estadounidense desde noviembre de 1980. Con 499 registros y 8 variables clave, el dataset captura los principales indicadores macroecon√≥micos que definen el estado de la econom√≠a.

<br/>

##### Variables y su naturaleza:

<br/>

1.  **date** (Temporal)

    -   Tipo: Variable cuantitativa discreta

    -   Formato: YYYY-MM-DD

    -   Periodicidad: Mensual

    -   Rango: Desde noviembre 1980

    <br/>

2.  **CPI** (√çndice de Precios al Consumidor)

    -   Tipo: Variable cuantitativa continua

    -   Unidad de medida: √çndice base 100

    -   Relevancia: Indicador principal de inflaci√≥n

    -   Rango observado: 85.6 - 291.5

    <br/>

3.  **Mortgage_rate** (Tasa Hipotecaria)

    -   Tipo: Variable cuantitativa continua

    -   Unidad de medida: Porcentaje (%)

    -   Rango observado: 2.684% - 18.454%

    -   Importancia: Indicador del costo del cr√©dito hipotecario

    <br/>

4.  **Unemp_rate** (Tasa de Desempleo)

    -   Tipo: Variable cuantitativa continua

    -   Unidad de medida: Porcentaje (%)

    -   Rango observado: 3.500% - 14.700%

    -   Significado: Proporci√≥n de la poblaci√≥n activa sin empleo

    <br/>

5.  **NASDAQ** (√çndice Burs√°til)

    -   Tipo: Variable cuantitativa continua

    -   Unidad de medida: Puntos

    -   Rango observado: 167.4 - 15,814.9

    -   Relevancia: Indicador del mercado de valores tecnol√≥gico

    <br/>

6.  **disposable_income** (Ingreso Disponible)

    -   Tipo: Variable cuantitativa continua

    -   Unidad de medida: D√≥lares estadounidenses

    -   Rango observado: 4,965 - 19,120

    -   Significado: Ingreso despu√©s de impuestos disponible para consumo o ahorro

        <br/>

7.  **Personal_consumption_expenditure** (Gasto en Consumo Personal)

    -   Tipo: Variable cuantitativa continua

    -   Unidad de medida: D√≥lares estadounidenses

    -   Rango observado: 1,827 - 16,955

    -   Importancia: Indicador del consumo privado

    <br/>

8.  **personal_savings** (Ahorros Personales)

    -   Tipo: Variable cuantitativa continua

    -   Unidad de medida: Porcentaje (%)

    -   Rango observado: 2.100% - 33.800%

    -   Significado: Proporci√≥n del ingreso destinado al ahorro

<br/>

```{r}
USmacro_data <- read.csv("US_macroeconomics.csv")
m2liquidity <- read.csv("m2_liquidity_data.csv")
head(USmacro_data)
```

```{r}
tail(USmacro_data)
```

<br/>

#### **2. M2 Liquidity (m2liquidity)**

<br/>

Este dataset, obtenido directamente de la Reserva Federal de St. Louis (FRED), proporciona informaci√≥n crucial sobre la oferta monetaria en Estados Unidos desde 1959. La medida M2 es particularmente importante para entender la pol√≠tica monetaria y sus efectos en la econom√≠a real.

##### Variables y su naturaleza:

<br/>

1.  **date** (Temporal)

    -   Tipo: Variable cuantitativa discreta

    -   Formato: YYYY-MM-DD

    -   Periodicidad: Mensual

    -   Rango: Desde enero 1959

    <br/>

2.  **value** (M2 Money Stock)

    -   Tipo: Variable cuantitativa continua

    -   Unidad de medida: Miles de millones de d√≥lares estadounidenses

    -   Rango observado: 286.6 - 21,722.3

    -   Componentes detallados del M2:

        <br/>

        a)  **Efectivo en circulaci√≥n**

        -   Billetes y monedas en manos del p√∫blico

        -   Dinero f√≠sico utilizado en transacciones diarias

        -   Componente m√°s l√≠quido del M2

            <br/>

        b)  **Dep√≥sitos a la vista**

        -   Cuentas corrientes en bancos comerciales

        -   Fondos disponibles para retiro inmediato

        -   Utilizados principalmente para transacciones

        -   No generan intereses o generan intereses muy bajos

            <br/>

        c)  **Cuentas de ahorro**

        -   Dep√≥sitos que generan intereses

        -   Acceso relativamente f√°cil pero no inmediato

        -   Incluye cuentas de ahorro regulares y cuentas del mercado monetario

        -   Suelen tener l√≠mites en el n√∫mero de retiros mensuales

            <br/>

        d)  **Dep√≥sitos a plazo menores a \$100,000**

        -   Certificados de dep√≥sito (CDs) peque√±os

        -   Plazo fijo con penalizaci√≥n por retiro anticipado

        -   Mayores tasas de inter√©s que las cuentas de ahorro

        -   Importantes para el ahorro a mediano plazo

            <br/>

        e)  **Fondos del mercado monetario minoristas**

        -   Inversiones en instrumentos de deuda a corto plazo

        -   Alta liquidez y bajo riesgo

        -   Rendimientos generalmente superiores a cuentas de ahorro tradicionales

        -   Utilizados como alternativa a las cuentas bancarias tradicionales

<br/>

```{r}
head(m2liquidity)
```

```{r}
tail(m2liquidity)
```

<br/>

Como se puede observar las primeras dos columnas de los datos de M2 no sirven de nada ya que solo muestran de forma repetida el dia en el que se descargaron los datos, asi que las eliminamos.

<br/>

```{r}
# Eliminar las dos primeras columnas de dataset1
m2liquidity <- m2liquidity[, -c(1, 2)]
head(m2liquidity)
```

<br/>

A continuaci√≥n vamos a extraer un poco m√°s de informaci√≥n a cerca de ambos dataset usando la funci√≥n summary(), y el any(is.na()), para ver informaci√≥n de los datos de cada columna, y conocer los "na" en cada una de ellas, respectivamente.

<br/>

```{r}
# Verificaci√≥n de valores faltantes
summary(USmacro_data)
any(is.na(USmacro_data))
```

```{r}
# Verificaci√≥n de valores faltantes
summary(m2liquidity)
any(is.na(m2liquidity))
```

<br/>

Como podemos observar en ning√∫n dataset encontramos ning√∫n tipo de dato "na", lo que parece ser una muy buena se√±al.

Ahora, vamos a ver la estructura de los datos de cada dataset por si tuvieramos que realizar algun cambio.

<br/>

```{r}
str(USmacro_data)
str(m2liquidity)
```

<br/>

Parece que los datos de la columna "date" son son caracteres, "chr", por lo que vamos a cambiarlos por datos tipo "Date".

<br/>

```{r}
USmacro_data$date <- as.Date(USmacro_data$date)
m2liquidity$date <- as.Date(m2liquidity$date)

str(USmacro_data)
str(m2liquidity)
```

<br/>

Lo √∫ltimo que nos queda antes de comenzar a trabajar es juntar ambos datasets. Como ya hemos comentado, no tienen la misma longitud, por lo que utilizaremos la funci√≥n "merge" para juntar ambos basandonos en las fechas comunes.

<br/>

```{r}
merged_data <- merge(USmacro_data, m2liquidity, by = "date")
head(merged_data)
```

```{r}
str(merged_data)
```

<br/>

#### **An√°lisis de Correlaciones y Potencial Anal√≠tico**

<br/>

**Introducci√≥n al An√°lisis de Correlaciones**

<br/>

Tras haber realizado una exhaustiva recopilaci√≥n y procesamiento de datos macroecon√≥micos estadounidenses, podemos profundizar en el an√°lisis de las relaciones entre las distintas variables estudiadas. La comprensi√≥n de estas interrelaciones es fundamental por varios motivos:

1.  Permite identificar **patrones** y **dependencias** entre variables macroecon√≥micas clave
2.  Facilita la comprensi√≥n de los mecanismos de transmisi√≥n de la pol√≠tica monetaria
3.  Ayuda a prever posibles impactos de cambios en determinadas variables sobre otras
4.  Proporciona una base s√≥lida para la toma de decisiones en pol√≠tica econ√≥mica

En esta secci√≥n, nos centraremos en el an√°lisis de las correlaciones entre las variables estudiadas, utilizando t√©cnicas estad√≠sticas que nos permitir√°n cuantificar y visualizar estas relaciones. Este an√°lisis no solo nos ayudar√° a entender mejor la estructura de la econom√≠a estadounidense, sino que tambi√©n nos permitir√° identificar √°reas potenciales para investigaci√≥n futura.

<br/>

**Metodolog√≠a y Visualizaci√≥n**

<br/>

Para realizar este an√°lisis, utilizaremos la **matriz de correlaci√≥n** como herramienta principal. Esta matriz nos permite visualizar de manera clara y concisa las relaciones entre pares de variables, donde:

-   Los valores cercanos a 1 indican una fuerte correlaci√≥n positiva
-   Los valores cercanos a -1 indican una fuerte correlaci√≥n negativa
-   Los valores cercanos a 0 indican ausencia de correlaci√≥n lineal

Este procedimiento no solo sirve para evidenciar la existencia de asociaciones estad√≠sticamente relevantes, sino que tambi√©n orient√≥ la selecci√≥n y futura comparaci√≥n de aquellas variables que presentasen un v√≠nculo potencialmente √∫til para explicar el comportamiento del NASDAQ.

<br/>

```{r}
# Cargar librer√≠a
library(corrplot)

# Seleccionar solo las columnas num√©ricas para la correlaci√≥n
datos_numericos <- merged_data[, c("CPI", "Mortgage_rate", "Unemp_rate", "NASDAQ", 
                                 "disposable_income", "Personal_consumption_expenditure",
                                 "personal_savings", "value")]

# Renombrar columnas para mejor visualizaci√≥n
colnames(datos_numericos) <- c("CPI", "Tasa Hipot.", "Desempleo", "NASDAQ", 
                             "Ingreso Disp.", "Consumo", "Ahorro", "M2")

# Calcular matriz de correlaci√≥n
matriz_correlacion <- cor(datos_numericos)

# Crear el gr√°fico
corrplot(matriz_correlacion,
         method = "color",      # Usar colores para visualizar
         addCoef.col = "black", # Mostrar coeficientes en negro
         number.cex = 0.7,      # Tama√±o de los n√∫meros
         tl.col = "black",      # Color del texto de etiquetas
         tl.srt = 45,          # Rotar texto 45 grados
         diag = FALSE) 
```

<br/>

**An√°lisis de las Correlaciones Observadas**

La matriz de correlaci√≥n revela patrones significativos en las relaciones entre variables macroecon√≥micas:

<br/>

Una vez conocidas las correlaciones b√°sicas, se proceder√° a un an√°lisis detallado y exhaustivo de cada serie temporal de manera individual. Este estudio comprende:

<br/>

-   La evaluaci√≥n de tendencias a largo plazo y posibles patrones de estacionalidad.

-   La identificaci√≥n y discusi√≥n de acontecimientos hist√≥ricos que pudiesen haber afectado significativamente a cada variable (p. ej., crisis econ√≥micas, cambios en la pol√≠tica monetaria de la Reserva Federal, contextos geopol√≠ticos, entre otros).

-   La determinaci√≥n de los per√≠odos de mayor volatilidad y las causas subyacentes, con el fin de comprender c√≥mo estas fluctuaciones pudieron repercutir en la poblaci√≥n y, por ende, en los mercados financieros.

    <br/>

Estudiar cada variable de manera individual posibilit√≥ la comprensi√≥n integral del contexto macroecon√≥mico y monetario y deline√≥ c√≥mo cada componente podr√≠a incidir en el movimiento del √≠ndice burs√°til.

<br/>

**1. Relaciones con la Oferta Monetaria (M2)**

\- El √≠ndice de precios al consumidor (CPI) de Estados Unidos tiene una fuerte correlaci√≥n con la oferta monetaria (M2 liquidity) debido a la relaci√≥n fundamental entre la cantidad de dinero en circulaci√≥n y los niveles de precios en una econom√≠a.

\- La correlaci√≥n con el NASDAQ sugiere una influencia significativa de la pol√≠tica monetaria en los mercados financieros

Esta relaci√≥n puede explicarse desde varias perspectivas econ√≥micas:

<br/>

**Teor√≠a cuantitativa del dinero**

ùëÄùëâ=ùëÉùëÑ

donde:

-   M es la **oferta monetaria** (como M2)

-   V es la **velocidad del dinero** (la frecuencia con la que una unidad de moneda es utilizada para comprar bienes y servicios)

-   P es el **nivel de precios** (representado por el CPI)

-   Q es el producto real o la **producci√≥n econ√≥mica**.

Si V y Q permanecen relativamente constantes, un aumento en M genera un aumento proporcional en P, es decir, en los precios. Esto implica que cuando se incrementa la cantidad de dinero en circulaci√≥n (M2), eventualmente el nivel de precios tiende a subir, lo que se refleja en el CP

<br/>

**Efectos de la liquidez**

-   Cuando la oferta monetaria aumenta, los consumidores y empresas tienen m√°s liquidez. Esto puede llevar a un aumento en la demanda de bienes y servicios.

-   Si la oferta de bienes y servicios no crece al mismo ritmo que la demanda, los precios tienden a subir, incrementando el CPI.

<br/>

```{r}
# Cargar librer√≠a
library(ggplot2)

# 1. Relaciones con la Oferta Monetaria (M2)
# Gr√°fico de M2
ggplot(merged_data, aes(x = date, y = value)) +
  geom_line(color = "blue") +
  labs(title = "Evoluci√≥n de M2 a lo largo del tiempo",
       y = "M2 (Miles de millones USD)",
       x = "A√±o") +
  theme_minimal()
```

La oferta monetaria (M2) ha mostrado un crecimiento significativo a partir de 1980, con una aceleraci√≥n notable despu√©s de 2008 y un crecimiento a√∫n m√°s pronunciado a partir de 2020.

La crisis financiera de 2008 llev√≥ a una pol√≠tica monetaria expansiva, con la Reserva Federal (Fed) implementando programas de flexibilizaci√≥n cuantitativa (QE).

Durante la pandemia de COVID-19 en 2020, la Fed increment√≥ a√∫n m√°s la oferta monetaria para mitigar los efectos econ√≥micos de los confinamientos, lo que explica el pico reciente.

<br/>

-   **Descomposici√≥n de serie temporal:**

```{r}
# Convertir las fechas al formato adecuado en merged_data
merged_data$date <- as.Date(merged_data$date)

# Crear la serie temporal para M2
ts_data <- ts(merged_data$value, start = c(1980, 11), frequency = 12)

# Descomposici√≥n STL
decomposed <- stl(ts_data, s.window = "periodic")

# Graficar la descomposici√≥n
plot(decomposed, main = "Descomposici√≥n de la serie temporal M2")
```

**M2 Liquidity**

-   **Tendencia**: Muestra un aumento constante en la liquidez M2 desde 1980. Este crecimiento se acelera especialmente despu√©s del 2020, probablemente debido a pol√≠ticas monetarias expansivas.

-   **Estacionalidad**: Exhibe un patr√≥n c√≠clico claro, posiblemente relacionado con pol√≠ticas monetarias regulares o factores econ√≥micos estacionales.

-   **Residuos**: Picos significativos alrededor del 2020, coincidiendo con la pandemia, lo que sugiere anomal√≠as econ√≥micas.

<br/>

```{r}
# Gr√°fico de CPI
ggplot(merged_data, aes(x = date, y = CPI)) +
  geom_line(color = "red") +
  labs(title = "Evoluci√≥n del CPI a lo largo del tiempo",
       y = "CPI",
       x = "A√±o") +
  theme_minimal()
```

El √çndice de Precios al Consumidor (IPC) muestra un crecimiento constante con algunos picos ocasionales. A partir de 2020, se aprecia un incremento m√°s acelerado.

La inflaci√≥n reciente puede estar vinculada a los est√≠mulos fiscales y monetarios masivos post-pandemia, junto con interrupciones en la cadena de suministro global.

Las tensiones geopol√≠ticas (como la guerra en Ucrania) han afectado los precios de la energ√≠a y los alimentos, contribuyendo a la inflaci√≥n.

<br/>

-   **Descomposici√≥n de serie temporal:**

```{r}
# Convertir las fechas al formato adecuado en merged_data
merged_data$date <- as.Date(merged_data$date)

# Crear la serie temporal para CPI
ts_data <- ts(merged_data$CPI, start = c(1980, 11), frequency = 12)

# Descomposici√≥n STL
decomposed <- stl(ts_data, s.window = "periodic")

# Graficar la descomposici√≥n
plot(decomposed, main = "Descomposici√≥n de la serie temporal CPI")
```

**CPI (√çndice de Precios al Consumidor)**

-   **Tendencia**: La inflaci√≥n muestra un aumento continuo desde 1980, con una aceleraci√≥n m√°s notable despu√©s del 2020.

-   **Estacionalidad**: Oscilaciones regulares, posiblemente reflejando aumentos de precios en ciertos per√≠odos del a√±o.

-   **Residuos**: Variabilidad significativa durante las crisis econ√≥micas de 2008 y 2020.

<br/>

```{r}
# Gr√°fico del NASDAQ
ggplot(merged_data, aes(x = date, y = NASDAQ)) +
  geom_line(color = "green") +
  labs(title = "Evoluci√≥n del NASDAQ a lo largo del tiempo",
       y = "NASDAQ",
       x = "A√±o") +
  theme_minimal()
```

El √≠ndice NASDAQ ha mostrado un crecimiento espectacular desde 1980, con grandes burbujas en 2000 (burbuja tecnol√≥gica), 2008 y la m√°s reciente en 2022.

La burbuja tecnol√≥gica de 2000 explot√≥ debido a la sobrevaloraci√≥n de empresas de tecnolog√≠a.

M√°s recientemente, el auge de las tecnol√≥gicas durante la pandemia impuls√≥ el NASDAQ, aunque tambi√©n sufri√≥ correcciones significativas en 2022 debido al endurecimiento de las pol√≠ticas monetarias.

Esta es la relaci√≥n, entre los mercados y la liquidez (M2 Liquidity), en pol√≠ticas monetarias expansivas, la econom√≠a se sobre estimula de manera artificial provocando los conocidos "mercados alcistas", al igual que con las pol√≠ticas restrictivas a traves de subidas de las tasas de inter√©s, se enfria la econom√≠a de manera artificial.

<br/>

-   **Descomposici√≥n de serie temporal:**

```{r}
# Convertir las fechas al formato adecuado en merged_data
merged_data$date <- as.Date(merged_data$date)

# Crear la serie temporal para NASDAQ
ts_data <- ts(merged_data$NASDAQ, start = c(1980, 11), frequency = 12)

# Descomposici√≥n STL
decomposed <- stl(ts_data, s.window = "periodic")

# Graficar la descomposici√≥n
plot(decomposed, main = "Descomposici√≥n de la serie temporal NASDAQ")
```

**NASDAQ**

-   **Tendencia**: Presenta un fuerte crecimiento, especialmente a partir de la d√©cada de 2010, con una marcada aceleraci√≥n post-2020.

-   **Estacionalidad**: Patrones estacionales menos evidentes, pero hay cierta repetici√≥n c√≠clica.

-   **Residuos**: Grandes picos alrededor del 2000 (burbuja tecnol√≥gica) y 2020 (pandemia), reflejando eventos excepcionales en el mercado.

<br/>

**2. Mercado Laboral y Consumo**

\- La tasa de desempleo muestra correlaciones negativas con el ingreso disponible y el consumo

\- Estas relaciones reflejan el impacto directo de las condiciones laborales en el bienestar econ√≥mico

<br/>

```{r}
# 2. Mercado Laboral y Consumo
# Gr√°fico de Desempleo
ggplot(merged_data, aes(x = date, y = Unemp_rate)) +
  geom_line(color = "red") +
  labs(title = "Evoluci√≥n de la Tasa de Desempleo",
       y = "Tasa de Desempleo (%)",
       x = "A√±o") +
  theme_minimal()

```

Muestra picos claros durante recesiones, especialmente en 2008 y 2020.

El desempleo se dispar√≥ durante la crisis financiera de 2008 y, m√°s recientemente, debido a la pandemia de COVID-19.

Las r√°pidas medidas de est√≠mulo, relacionadas con el aumento de la M2 liquidity, permitieron una recuperaci√≥n m√°s r√°pida del empleo tras la pandemia en comparaci√≥n con crisis previas.

<br/>

-   **Descomposici√≥n de serie temporal:**

```{r}
# Convertir las fechas al formato adecuado en merged_data
merged_data$date <- as.Date(merged_data$date)

# Crear la serie temporal para Tasa de Desempleo
ts_data <- ts(merged_data$Unemp_rate, start = c(1980, 11), frequency = 12)

# Descomposici√≥n STL
decomposed <- stl(ts_data, s.window = "periodic")

# Graficar la descomposici√≥n
plot(decomposed, main = "Descomposici√≥n de la serie temporal Unemp_rate")
```

**Unemployment Rate**

-   **Tendencia**: Declive general en la tasa de desempleo, salvo repuntes claros durante las crisis (2008 y 2020).

-   **Estacionalidad**: Variaciones c√≠clicas anuales, probablemente reflejando fluctuaciones estacionales del mercado laboral.

-   **Residuos**: Grandes picos durante las crisis, reflejando un fuerte impacto externo.

<br/>

```{r}
# Gr√°fico de Ingreso Disponible
ggplot(merged_data, aes(x = date, y = disposable_income)) +
  geom_line(color = "blue") +
  labs(title = "Evoluci√≥n del Ingreso Disponible",
       y = "Ingreso Disponible (USD)",
       x = "A√±o") +
  theme_minimal()
```

Crecimiento constante, con picos notables alrededor de 2020, explicado por los paquetes de est√≠mulo directo a los hogares durante la pandemia explican los picos en ingreso disponible.

La recuperaci√≥n de ingresos en 2021 se debi√≥ a la reapertura de la econom√≠a y la recuperaci√≥n del empleo.

En esta gr√°fica podemos observar como grandes crisis como la burbuja de las punto com, la crisis financiera global de 2008, aparecen dejando picos, pero nada parecido a los de 2020. Esto nos indica que la inyecci√≥n que se llevo acabo fue mucho mayor que en momentos anteriores.

<br/>

-   **Descomposici√≥n de serie temporal:**

```{r}
# Convertir las fechas al formato adecuado en merged_data
merged_data$date <- as.Date(merged_data$date)

# Crear la serie temporal para Ingreso Disponible
ts_data <- ts(merged_data$disposable_income, start = c(1980, 11), frequency = 12)

# Descomposici√≥n STL
decomposed <- stl(ts_data, s.window = "periodic")

# Graficar la descomposici√≥n
plot(decomposed, main = "Descomposici√≥n de la serie temporal Ingresio disponible")
```

**Ingreso Disponible**

-   **Tendencia**: Incremento sostenido, con una aceleraci√≥n notable despu√©s del 2020.

-   **Estacionalidad**: Ciclos regulares que reflejan patrones estacionales de ingresos.

-   **Residuos**: Picos an√≥malos, especialmente durante los per√≠odos de crisis econ√≥micas.

<br/>

**3. Din√°mica del Consumo**

\- La fuerte correlaci√≥n entre ingreso disponible y consumo personal confirma la teor√≠a econ√≥mica b√°sica

\- El ahorro personal muestra patrones m√°s complejos, sugiriendo la influencia de factores adicionales

<br/>

```{r}
# 3. Din√°mica del Consumo
# Gr√°fico de Consumo Personal
ggplot(merged_data, aes(x = date, y = Personal_consumption_expenditure)) +
  geom_line(color = "purple") +
  labs(title = "Evoluci√≥n del Consumo Personal",
       y = "Consumo Personal (USD)",
       x = "A√±o") +
  theme_minimal()
```

Crecimiento consistente con una ca√≠da breve durante la pandemia, seguida de una r√°pida recuperaci√≥n.

El consumo personal es altamente sensible al ingreso disponible. La ca√≠da durante la pandemia refleja la incertidumbre y las restricciones, mientras que los est√≠mulos gubernamentales ayudaron a reactivar el consumo r√°pidamente.

<br/>

-   **Descomposici√≥n de serie temporal:**

```{r}
# Convertir las fechas al formato adecuado en merged_data
merged_data$date <- as.Date(merged_data$date)

# Crear la serie temporal para Consumo Personal
ts_data <- ts(merged_data$Personal_consumption_expenditure, start = c(1980, 11), frequency = 12)

# Descomposici√≥n STL
decomposed <- stl(ts_data, s.window = "periodic")

# Graficar la descomposici√≥n
plot(decomposed, main = "Descomposici√≥n de la serie temporal Consumo Personal")
```

**Consumo Personal**

-   **Tendencia**: Crecimiento constante en el gasto de los consumidores.

-   **Estacionalidad**: Claros patrones c√≠clicos, probablemente relacionados con temporadas de alta demanda (como fin de a√±o).

-   **Residuos**: Fluctuaciones alrededor del 2020, reflejando cambios en el consumo debido a la pandemia.

<br/>

```{r}
# Gr√°fico de Ahorro Personal
ggplot(merged_data, aes(x = date, y = personal_savings)) +
  geom_line(color = "orange") +
  labs(title = "Evoluci√≥n del Ahorro Personal",
       y = "Tasa de Ahorro Personal (%)",
       x = "A√±o") +
  theme_minimal()
```

Oscila hist√≥ricamente en torno al 5-10%, con un pico inusual durante 2020 y un retorno r√°pido a niveles previos.

Durante la pandemia, los hogares aumentaron sus tasas de ahorro debido a la incertidumbre y la reducci√≥n del gasto en bienes y servicios no esenciales. Posteriormente, al relajarse las restricciones, el ahorro cay√≥ r√°pidamente con el repunte del consumo.

Se puede observar como desde 1980 hasta 2005/6, la tendencia del ahorro estaba descendiendo de forma calmada, tras la crisis de 2008, el ahorro de los hogares comienza a recuperar cotas perdidas hace decadas, y no de forma tan artificial como en 2020, colocandose entre el 5% y el 10%. Esto puede ser debido a un miedo generalizado entre los hogares despues de vivir una crisis reciente, y el instinto de estar preparado por si vuelve a pasar.

```{r}
# Convertir las fechas al formato adecuado en merged_data
merged_data$date <- as.Date(merged_data$date)

# Crear la serie temporal para Ahorro Personal
ts_data <- ts(merged_data$personal_savings, start = c(1980, 11), frequency = 12)

# Descomposici√≥n STL
decomposed <- stl(ts_data, s.window = "periodic")

# Graficar la descomposici√≥n
plot(decomposed, main = "Descomposici√≥n de la serie temporal Ahorro Personal")
```

**Ahorro Personal**

-   **Tendencia**: Generalmente estable, con un incremento abrupto alrededor de 2020, posiblemente debido a la reducci√≥n del gasto durante la pandemia.

-   **Estacionalidad**: Muestra patrones c√≠clicos regulares.

-   **Residuos**: Grandes picos durante eventos econ√≥micos extraordinarios, como 2020.

<br/>

#### **Comparaci√≥n entre las variables**

<br/>

Con los resultados de la matriz de correlaci√≥n y el an√°lisis individual, se realizar√° una contrastaci√≥n m√°s profunda entre parejas de variables. Se seleccionaron aquellas con correlaciones de magnitud considerable y se abord√≥ su explicaci√≥n desde la perspectiva macroecon√≥mica.

<br/>

```{r}
# Cargar las librer√≠as necesarias
library(ggplot2)

# Gr√°fico de dispersion CPI vs. Mortgage_rate y linea de regresi√≥n
ggplot(merged_data, aes(x = CPI, y = Mortgage_rate)) +
  geom_point(alpha = 0.6, color = "blue") +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(title = "CPI vs Mortgage_rate",
       x = "CPI (Inflaci√≥n)",
       y = "Tasa de Hipoteca") +
  theme_minimal()
```

-   **Observaci√≥n**:

1.  La relaci√≥n es claramente **negativa**, como era de esperar. A medida que el CPI aumenta, la tasa de hipoteca tiende a disminuir. Esto sugiere que en per√≠odos de alta inflaci√≥n, las tasas hipotecarias han bajado, posiblemente debido a pol√≠ticas monetarias expansivas.

2.  **Curvatura al final**: En los valores m√°s altos de CPI (posteriores), la tasa hipotecaria parece comenzar a estabilizarse o incluso subir ligeramente. Esto podr√≠a indicar un cambio en la pol√≠tica monetaria reciente.

<br/>

```{r}
# Gr√°fico de dispersion M2 vs. Mortgage_rate y linea de regresi√≥n
ggplot(merged_data, aes(x = value, y = Mortgage_rate)) +
  geom_point(alpha = 0.6, color = "purple") +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(title = "M2 Liquidity vs Mortgage_rate",
       x = "M2 Liquidity",
       y = "Tasa de Hipoteca") +
  theme_minimal()
```

-   **Observaci√≥n**:

    Existe una **relaci√≥n negativa**: mayor liquidez en la econom√≠a (M2) est√° asociada con tasas hipotecarias m√°s bajas. Esto es consistente con per√≠odos de pol√≠tica monetaria expansiva donde se inyecta m√°s dinero para reducir las tasas.

<br/>

```{r}
# Gr√°fico de dispersion M2 vs. CPI y linea de regresi√≥n
ggplot(merged_data, aes(x = value, y = CPI)) +
  geom_point(alpha = 0.6, color = "brown") +
  geom_smooth(method = "lm", color = "red", se = FALSE) +
  labs(title = "M2 Liquidity vs CPI",
       x = "M2 Liquidity",
       y = "CPI (Inflaci√≥n)") +
  theme_minimal()
```

-   **Observaci√≥n**:

    Relaci√≥n **positiva fuerte**. A medida que la liquidez aumenta, el CPI tambi√©n lo hace, es por esto que despues de politicas monetarias expansivas vivimos aumentos de precio (inflaci√≥n)

<br/>

**Regresiones Multivariadas**

<br/>

**¬øQu√© es?**: Es un modelo estad√≠stico que permite analizar el impacto de **m√∫ltiples variables independientes (predictoras)** sobre una **variable dependiente**. A diferencia de la regresi√≥n simple, aqu√≠ puedes estudiar c√≥mo **varias variables juntas** explican los cambios en la variable objetivo.

**¬øPor qu√© podr√≠a ser √∫til?**:

-   Podriamos analizar c√≥mo **CPI**, **M2**, y **Mortgage_rate** afectan simult√°neamente al **NASDAQ**.

-   Nos permitir√≠a ver qu√© variable tiene un impacto m√°s fuerte sobre la variables dependiente, controlando por las dem√°s.

-   Tambi√©n puede ayudarte a **aislar efectos**: por ejemplo, determinar si la relaci√≥n entre **CPI y Mortgage_rate** sigue siendo significativa despu√©s de controlar por **M2 Liquidity**.

```{r}
# Modelo de regresi√≥n m√∫ltiple para NASDAQ
modelo_nasdaq <- lm(NASDAQ ~ CPI + value + Mortgage_rate + Unemp_rate, data = merged_data)

# Resumen del modelo
summary(modelo_nasdaq)
```

-   **Intercept**:

El valor base del **NASDAQ** es **3865.95** cuando todas las variables independientes son iguales a cero. Aunque este valor tiene un significado limitado en este contexto, es √∫til para la interpretaci√≥n global.

<br/>

-   **CPI (√çndice de Precios al Consumidor)**:

**Coeficiente**: -32.94

**Interpretaci√≥n**: Por cada unidad adicional en el **CPI**, el **NASDAQ** tiende a reducirse en 32.94 puntos, manteniendo constantes las dem√°s variables.

**Significancia**: Es altamente significativo (**p \< 2e-16**), lo que sugiere que la inflaci√≥n tiene un impacto importante y negativo en el desempe√±o del mercado.

<br/>

-   **Value (M2 Liquidity)**:

**Coeficiente**: 0.93

**Interpretaci√≥n**: Por cada unidad de aumento en **value**, el **NASDAQ** aumenta en 0.93 puntos.

**Significancia**: Altamente significativa (**p \< 2e-16**). Esto indica una relaci√≥n positiva robusta entre esta variable y el mercado.

<br/>

-   **Mortgage_rate (Tasa de Hipoteca)**:

**Coeficiente**: 7.41

**Interpretaci√≥n**: Un aumento en la tasa de hipoteca incrementa ligeramente el √≠ndice NASDAQ en 7.41 puntos.

**Significancia**: No significativa (**p = 0.791**). La tasa de hipoteca no parece tener un impacto importante directo sobre el NASDAQ en este modelo.

<br/>

-   **Unemp_rate (Tasa de Desempleo)**:

**Coeficiente**: -281.45

**Interpretaci√≥n**: Por cada unidad adicional en la **tasa de desempleo**, el **NASDAQ** disminuye en 281.45 puntos.

**Significancia**: Altamente significativa (**p \< 2e-16**). Esto sugiere que el desempleo es un factor clave y negativo para el mercado burs√°til.

<br/>

-   **R¬≤ (R-cuadrado)**: 0.9448

    El modelo explica el **94.48%** de la variabilidad en el √≠ndice NASDAQ, lo que indica un excelente ajuste.

-   **F-Statistic** (Eval√∫a si al menos una de las variables independientes tiene un efecto significativo en la variable dependiente): 2115 (p \< 2.2e-16)

    El modelo global es altamente significativo.

-   **Errores residuales**:

    Los residuos tienen un rango bastante amplio (-1885.8 a 3260.3), pero la **desviaci√≥n est√°ndar residual** de **741.2** es razonable dado el rango de valores del NASDAQ.

<br/>

**Conclusiones**:

-   **CPI** y **Unemployment_rate** son las variables que m√°s negativamente afectan al √≠ndice NASDAQ.

-   **Value** tiene un efecto positivo significativo.

-   **Mortgage_rate** no muestra un impacto relevante en este an√°lisis.

<br/>

<br/>

La intervenci√≥n agresiva de la Fed y del gobierno de EE.UU. en momentos de crisis ha tenido efectos visibles en la econom√≠a, desde los mercados financieros como el NASDAQ, hasta el ahorro del individuo, pasando por el consumo personal.

Las gr√°ficas destacan c√≥mo el aumento de M2 ha tenido un impacto en la inflaci√≥n, ya que como observamos el aumento de la m2 liquidity en la crisis de 2020 fue mucho mayor que en 2008, provocando un aumento exorbitado de la liquidez con el objetivo de evitar una crisis mayor, aceptando as√≠ un aumento de la inflaci√≥n durante un breve periodo de tiempo.

<br/>

#### **Continuidad del Proyecto hacia Modelos Predictivos**

<br/>

Este an√°lisis ha evidenciado la estrecha relaci√≥n entre los indicadores macroecon√≥micos y el comportamiento del mercado financiero en Estados Unidos. En particular, la correlaci√≥n entre la masa monetaria M2 y el √≠ndice de precios al consumidor (CPI) destaca c√≥mo las pol√≠ticas monetarias influyen en la inflaci√≥n. A su vez, la relaci√≥n entre el CPI y el √≠ndice NASDAQ refuerza la idea de que los cambios en el poder adquisitivo afectan significativamente las din√°micas del mercado burs√°til.

La observaci√≥n de tendencias a trav√©s de series temporales tambi√©n revel√≥ c√≥mo crisis econ√≥micas espec√≠ficas, como la recesi√≥n de 2008, impactaron de manera significativa tanto en el mercado financiero como en indicadores econ√≥micos clave, subrayando la relaci√≥n entre estas variables.

<br/>

Para avanzar en este an√°lisis, la siguiente fase se centrar√° en el desarrollo de modelos predictivos. El objetivo principal ser√° predecir el √≠ndice NASDAQ utilizando variables macroecon√≥micas como el CPI, M2, y otras que puedan ser relevantes.

**Objetivos de la Fase Predictiva**

Predecir el comportamiento del √≠ndice NASDAQ: Comprender mejor c√≥mo factores como la liquidez M2 y la inflaci√≥n afectan a los mercados financieros.

Explorar otras variables predictivas: Identificar variables macroecon√≥micas que sean √∫tiles para anticipar tendencias econ√≥micas, como las tasas de desempleo o los ingresos disponibles.

<br/>

**Metodolog√≠as Propuestas Modelos Estad√≠sticos:**

-   **ARIMA**: Ideal para capturar patrones temporales en series univariadas como el CPI o el NASDAQ.

-   **VAR**: √ötil para explorar relaciones entre m√∫ltiples series temporales, como la interacci√≥n entre M2, CPI, y NASDAQ.

<br/>

**Modelos de Machine Learning:**

-   **Regresi√≥n Lineal M√∫ltiple**: Para evaluar la relaci√≥n entre m√∫ltiples variables predictoras y un objetivo.

-   **Redes Neuronales (RNN, LSTM)**: Dise√±adas para capturar patrones no lineales y dependencias temporales complejas, mejorando la capacidad de predicci√≥n en datos secuenciales.

<br/>

Finalmente, con la idea de materializar el objetivo √∫ltimo del estudio ‚Äîla predicci√≥n del NASDAQ‚Äî se evaluaron diversas metodolog√≠as, valorando tanto las fortalezas como las limitaciones en funci√≥n de la cantidad, el tipo de datos disponibles, la estructura temporal de las variables, etc.

Tras revisar diversas alternativas, el modelo **ARIMAX** (Autoregressive Integrated Moving Average with Exogenous Variables) fue elegido como la estrategia m√°s adecuada para esta investigaci√≥n, tanto por la periodicidad de los datos en los dataset, como el tama√±o de los mismos. Este modelo combina la capacidad de capturar componentes autorregresivos y de medias m√≥viles, al tiempo que permite incorporar variables ex√≥genas que, como se ha demostrado en el an√°lisis preliminar, ejercen una influencia notable en el √≠ndice burs√°til.

Para tener en cuenta en el modelo estas variables ex√≥genas hemos tenido que crear una matriz con los valores de estas desde el punto donde se realiza la prediccion (Mayo 2022) hasta el final, unos seis meses despues. Estos datos han sido recogidos de la pagina Datosmacro.com.

<br/>

```{r}
library(forecast)

# 1. Crear la serie temporal principal
nasdaq_ts <- ts(merged_data$NASDAQ, 
               start = c(1980, 11), 
               frequency = 12)

# 2. Crear la matriz de variables ex√≥genas
exog_vars <- cbind(
 CPI          = merged_data$CPI,
 Unemp_rate   = merged_data$Unemp_rate,
 Mortgage_rate= merged_data$Mortgage_rate
)

# 3. Ajustar el modelo ARIMAX
model_arimax <- auto.arima(
 nasdaq_ts, 
 xreg = exog_vars,
 stepwise = FALSE, 
 approximation = FALSE
)

# 4. Resumen del modelo
summary(model_arimax)

# 5. Crear matriz de valores futuros para variables ex√≥genas (6 meses desde mayo 2022)
future_xreg <- matrix(
c(
  # CPI futuros (junio 2022 a mayo 2023)
  c(296.311, 297.789, 296.171, 296.808, 298.012, 299.607),
  # Unemployment rate futuros (junio 2022 a mayo 2023)
  c(3.6, 3.5, 3.6, 3.5, 3.6, 3.6),
  # Mortgage rate futuros (junio 2022 a mayo 2023)
  c(5.5, 5.4, 5.2, 6.0, 6.9, 6.8)
),

 ncol = 3,
 dimnames = list(NULL, colnames(exog_vars))
)

# 6. Predicci√≥n a futuro
forecasts_arimax <- forecast(model_arimax, xreg = future_xreg, h = 6)

# 7. Visualizaci√≥n mejorada
plot(forecasts_arimax, 
    xlim = c(2020, 2023),
    main = "Predicci√≥n ARIMAX NASDAQ",
    ylab = "√çndice NASDAQ",
    xlab = "A√±o",
    col = "blue",
    fcol = "red",
    shadecols = c("#CCCCCC"))

# A√±adir leyenda
legend("topleft", 
      legend = c("Hist√≥rico", "Predicci√≥n", "Intervalo de confianza"),
      col = c("blue", "red", "grey"),
      lty = c(1, 1, 1),
      cex = 0.8)
```

<br/>

-   El **MAPE** mide el error promedio relativo entre los valores observados y predichos, expresado como un porcentaje.

    Un MAPE de 4.02% significa que, en promedio, las predicciones del modelo se desv√≠an un 4.02% de los valores reales, lo cual es considerado un error bajo y aceptable en an√°lisis de series temporales.

-   El **ME** representa el error promedio, sin importar su signo, y mide si el modelo tiene un sesgo en sus predicciones.

    El ME cercano a cero (2.52) sugiere que el modelo no tiene un sesgo significativo en las predicciones, es decir, no sobreestima ni subestima sistem√°ticamente los valores del √≠ndice.

-   El **RMSE** mide la magnitud promedio del error en t√©rminos absolutos, penalizando m√°s los errores grandes.

    Aunque el valor es alto (198.89), esto se debe a la naturaleza vol√°til del √≠ndice NASDAQ y a los valores elevados que maneja (superiores a 10,000 puntos).

-   **ACF1**. La autocorrelaci√≥n residual mide si los errores del modelo est√°n correlacionados entre s√≠, lo cual puede indicar un problema en el ajuste.

    Un ACF1 cercano a cero indica que el modelo ha capturado correctamente las relaciones temporales de la serie, y los residuos no tienen dependencias significativas.

-   El **CPI** mide la variaci√≥n en los precios de bienes y servicios, un indicador clave de la inflaci√≥n. El coeficiente positivo (23.45) indica que un aumento en el CPI est√° relacionado con un incremento en el √≠ndice NASDAQ, posiblemente debido a mayores expectativas de beneficios corporativos en un contexto inflacionario.

-   El coeficiente negativo (-39.10) sugiere que un aumento en las **tasas hipotecarias** reduce el √≠ndice NASDAQ, posiblemente debido al impacto negativo de tasas altas en el consumo y la inversi√≥n. Sin embargo, su alto error est√°ndar (39.89) indica que su influencia puede variar considerablemente.

-   **Sigma¬≤.** La varianza residual mide la dispersi√≥n de los errores del modelo (refleja que tan dispersos estan los valores predichos de los reales observados).

    Un valor elevado (40287) refleja que los errores son significativos en t√©rminos absolutos, lo que podr√≠a deberse a factores no capturados por el modelo, como eventos econ√≥micos no previstos.

<br/>

\
![](images/8888.png)

<br/>

Como podemos observar, el NASDAQ continuo con su caida, un 17,18% m√°s, pero la aceleraci√≥n con la que bajaba fue disminuyendo hasta aplanarse casi por completo, al igual que nos muestra nuestro modelo.

<br/>

```{r}
# An√°lisis de residuos
checkresiduals(model_arimax)
```

<br/>

-   **Gr√°fico de residuos:**

    -   Representa los errores del modelo a lo largo del tiempo.

    -   **¬øQu√© indica?** Los residuos parecen estar centrados alrededor de cero, lo que es deseable, pero hay algunos picos grandes sobre todo en los ultimos a√±os que podr√≠an reflejar eventos inusuales o puntos extremos no capturados por el modelo. En general, el comportamiento es aceptable para un modelo de series temporales.

-   **ACF de residuos :**

    -   **¬øQu√© es?** Muestra la autocorrelaci√≥n de los residuos a distintos retrasos (lags).

    -   **¬øQu√© indica?** Aunque la mayor√≠a de las barras est√°n dentro del intervalo de confianza (l√≠neas azules), hay algunos valores significativos en ciertos retrasos. Esto sugiere que no toda la dependencia temporal ha sido completamente eliminada, lo que podr√≠a indicar margen de mejora en el modelo.

-   **Histograma de residuos :**

    -   **¬øQu√© es?** Muestra la distribuci√≥n de los errores del modelo.

    -   **¬øQu√© indica?** La distribuci√≥n tiene una forma aproximadamente sim√©trica y centrada en cero, pero con una alta concentraci√≥n, lo que indica la presencia de algunos errores extremos. Esto podr√≠a reflejar limitaciones en el modelo para capturar movimientos bruscos del mercado.

-   **Prueba Ljung-Box** (herramienta estadistica de analisis de residuos comunmente utilizada importante para evaluar la calidad del modelo de regresi√≥n)

    -   **¬øQu√© es?** Eval√∫a si hay autocorrelaci√≥n significativa en los residuos hasta un n√∫mero espec√≠fico de retrasos (permiten evaluar si los residuos estan correlacionados con sus propios valores pasados). La autocorrelaci√≥n en los residuos indica que el modelo no ha capturado completamente la estructura de dependencia temporal presente en los datos.

    -   **¬øQu√© indica?** El p-value es muy bajo (**0.0002823**), lo que lleva a rechazar la hip√≥tesis nula de que no hay autocorrelaci√≥n en los residuos. Esto significa que el modelo no ha capturado completamente toda la estructura de dependencia temporal en los datos, lo que podr√≠a afectar la calidad de las predicciones.

-   **Grados de libertad :**

    -   **¬øQu√© es?** Indica el n√∫mero de retrasos considerados en la prueba Ljung-Box.

    -   **¬øQu√© indica?** Con 19 grados de libertad, la prueba eval√∫a una cantidad razonable de dependencia en el tiempo. Sin embargo, los residuos muestran que a√∫n queda autocorrelaci√≥n no explicada.

El modelo ARIMAX muestra un desempe√±o aceptable para capturar las tendencias generales del √≠ndice NASDAQ, con errores moderados y residuos centrados en cero.

Sin embargo, la presencia de autocorrelaci√≥n en los residuos, confirmada por la prueba Ljung-Box, indica que no toda la dependencia temporal ha sido eliminada, lo que limita su capacidad para prever movimientos extremos del mercado. A pesar de ser √∫til para an√°lisis generales, el modelo podr√≠a beneficiarse de ajustes adicionales en su estructura o la incorporaci√≥n de m√°s variables explicativas para mejorar su precisi√≥n y robustez.
